<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pentest Report - Form Editor</title>
  <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      background: #0D0C73;
      color: #ffffff;
      font-family: 'Fira Code', monospace;
      min-height: 100vh;
      overflow-x: hidden;
      background-image: 
        radial-gradient(circle at 20% 20%, rgba(255, 215, 0, 0.1) 0%, transparent 50%),
        radial-gradient(circle at 80% 80%, rgba(0, 212, 255, 0.08) 0%, transparent 50%),
        linear-gradient(135deg, #0D0C73 0%, #1a1a2e 50%, #16213e 100%);
      background-attachment: fixed;
    }

    .container {
      display: flex;
      height: 100vh;
      overflow: hidden;
    }

    /* Header Bar */
    .header-bar {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      height: 70px;
      background: rgba(26, 26, 26, 0.95);
      backdrop-filter: blur(25px);
      border-bottom: 2px solid rgba(255, 107, 53, 0.3);
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 2rem;
      z-index: 1000;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
    }

    .header-left {
      position: relative;
      left: 17%;
      display: flex;
      align-items: center;
      gap: 1.5rem;
    }

    .back-btn {
      background: rgba(255, 255, 255, 0.05);
      border: 2px solid rgba(255, 107, 53, 0.3);
      color: #FF6B35;
      padding: 0.6rem 1.2rem;
      border-radius: 10px;
      font-family: 'Fira Code', monospace;
      font-size: 0.85rem;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .back-btn:hover {
      background: rgba(255, 107, 53, 0.1);
      border-color: #FF6B35;
      transform: translateX(-4px);
    }

    .header-title {
      display: flex;
      flex-direction: column;
      gap: 0.2rem;
    }

    .header-title h1 {
      font-size: 1.3rem;
      color: #FF6B35;
      font-weight: 700;
    }

    .header-title span {
      font-size: 0.75rem;
      color: #aaa;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .header-actions {
      display: flex;
      gap: 1rem;
    }

    .generate-btn {
      background: linear-gradient(135deg, #FF6B35, #ff8c42);
      border: none;
      color: #fff;
      padding: 0.7rem 2rem;
      border-radius: 10px;
      font-family: 'Fira Code', monospace;
      font-size: 0.85rem;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.3s ease;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .generate-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 25px rgba(255, 107, 53, 0.4);
    }

    /* Sidebar Navigation */
    .sidebar {
      position: absolute;
      top: 0;
      right: 0;
      width: 280px;
      background: rgba(26, 26, 26, 0.95);
      backdrop-filter: blur(25px);
      border-right: 2px solid rgba(255, 107, 53, 0.2);
      padding: 2rem 1rem;
      margin-top: 70px;
      overflow-y: auto;
      height: calc(100vh - 70px);
    }

    .progress-container {
      margin-bottom: 2rem;
      padding: 1rem;
      background: rgba(255, 107, 53, 0.05);
      border-radius: 12px;
      border: 1px solid rgba(255, 107, 53, 0.2);
    }

    .progress-label {
      font-size: 0.75rem;
      color: #aaa;
      margin-bottom: 0.5rem;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .progress-bar-container {
      width: 100%;
      height: 8px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 4px;
      overflow: hidden;
      margin-bottom: 0.5rem;
    }

    .progress-bar {
      height: 100%;
      background: linear-gradient(90deg, #FF6B35, #ff8c42);
      width: 30%;
      transition: width 0.5s ease;
      box-shadow: 0 0 10px rgba(255, 107, 53, 0.5);
    }

    .progress-text {
      font-size: 0.8rem;
      color: #FF6B35;
      font-weight: 600;
    }

    .nav-section {
      margin-bottom: 0.5rem;
    }

    .nav-item {
      padding: 0.9rem 1.2rem;
      margin-bottom: 0.3rem;
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 0.8rem;
      font-size: 0.85rem;
      position: relative;
    }

    .nav-item::before {
      content: '';
      width: 20px;
      height: 20px;
      border-radius: 50%;
      border: 2px solid rgba(255, 255, 255, 0.2);
      flex-shrink: 0;
      transition: all 0.3s ease;
    }

    .nav-item.completed::before {
      content: '‚úì';
      background: #4FFBDF;
      border-color: #4FFBDF;
      color: #0A1628;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.7rem;
      font-weight: 700;
    }

    .nav-item.active {
      background: rgba(255, 107, 53, 0.15);
      border-left: 3px solid #FF6B35;
      padding-left: calc(1.2rem - 3px);
    }

    .nav-item.active::before {
      background: #FF6B35;
      border-color: #FF6B35;
      box-shadow: 0 0 15px rgba(255, 107, 53, 0.5);
    }

    .nav-item:hover:not(.active) {
      background: rgba(255, 255, 255, 0.05);
    }

    /* Main Content Area */
    .main-content {
      flex: 1;
      margin-top: 70px;
      padding: 3rem;
      overflow-y: auto;
      height: calc(100vh - 70px);
    }

    .form-section {
      display: none;
      max-width: 900px;
      margin: 0 auto;
      animation: fadeIn 0.5s ease;
    }

    .form-section.active {
      display: block;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .section-header {
      margin-bottom: 2rem;
      padding-bottom: 1rem;
      border-bottom: 2px solid rgba(255, 107, 53, 0.2);
    }

    .section-title {
      font-size: 1.8rem;
      color: #FF6B35;
      margin-bottom: 0.5rem;
      font-weight: 700;
    }

    .section-subtitle {
      font-size: 0.9rem;
      color: #aaa;
      line-height: 1.6;
    }

    .form-group {
      margin-bottom: 2rem;
    }

    .form-label {
      display: block;
      margin-bottom: 0.7rem;
      color: #fff;
      font-size: 0.9rem;
      font-weight: 600;
    }

    .form-label-optional {
      color: #666;
      font-weight: 400;
      font-size: 0.8rem;
      margin-left: 0.5rem;
    }

    .form-input,
    .form-textarea,
    .form-select {
      width: 100%;
      padding: 0.9rem 1.2rem;
      background: rgba(255, 255, 255, 0.05);
      border: 2px solid rgba(255, 107, 53, 0.2);
      border-radius: 10px;
      color: #fff;
      font-family: 'Fira Code', monospace;
      font-size: 0.9rem;
      transition: all 0.3s ease;
    }

    .form-input:focus,
    .form-textarea:focus,
    .form-select:focus {
      outline: none;
      background: rgba(255, 255, 255, 0.08);
      border-color: #FF6B35;
      box-shadow: 0 0 20px rgba(255, 107, 53, 0.2);
    }

    .form-textarea {
      min-height: 120px;
      resize: vertical;
    }

    .form-input::placeholder,
    .form-textarea::placeholder {
      color: #666;
    }

    /* Vulnerability Entry */
    .vuln-entry {
      background: rgba(26, 26, 26, 0.6);
      border: 2px solid rgba(255, 107, 53, 0.2);
      border-radius: 12px;
      padding: 1.5rem;
      margin-bottom: 1.5rem;
      position: relative;
    }

    .vuln-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
      padding-bottom: 1rem;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    .vuln-number {
      font-size: 1.1rem;
      font-weight: 700;
      color: #FF6B35;
    }

    .remove-vuln-btn {
      background: rgba(255, 107, 53, 0.1);
      border: 1px solid rgba(255, 107, 53, 0.3);
      color: #FF6B35;
      padding: 0.4rem 0.8rem;
      border-radius: 6px;
      font-size: 0.75rem;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .remove-vuln-btn:hover {
      background: rgba(255, 107, 53, 0.2);
      border-color: #FF6B35;
    }

    .form-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1.5rem;
    }

    .add-vuln-btn {
      width: 100%;
      padding: 1rem;
      background: rgba(79, 251, 223, 0.1);
      border: 2px dashed rgba(79, 251, 223, 0.4);
      border-radius: 10px;
      color: #4FFBDF;
      font-family: 'Fira Code', monospace;
      font-size: 0.9rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
    }

    .add-vuln-btn:hover {
      background: rgba(79, 251, 223, 0.15);
      border-color: #4FFBDF;
      transform: translateY(-2px);
    }

    /* Navigation Buttons */
    .form-navigation {
      display: flex;
      justify-content: space-between;
      margin-top: 3rem;
      padding-top: 2rem;
      border-top: 2px solid rgba(255, 107, 53, 0.2);
    }

    .nav-btn {
      padding: 0.9rem 2rem;
      border-radius: 10px;
      font-family: 'Fira Code', monospace;
      font-size: 0.9rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .prev-btn {
      background: rgba(255, 255, 255, 0.05);
      border: 2px solid rgba(255, 255, 255, 0.2);
      color: #fff;
    }

    .prev-btn:hover {
      background: rgba(255, 255, 255, 0.1);
      border-color: rgba(255, 255, 255, 0.4);
    }

    .next-btn {
      background: linear-gradient(135deg, #FF6B35, #ff8c42);
      border: none;
      color: #fff;
    }

    .next-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 25px rgba(255, 107, 53, 0.4);
    }

    /* Info Box */
    .info-box {
      background: rgba(79, 251, 223, 0.05);
      border-left: 3px solid #4FFBDF;
      padding: 1rem 1.2rem;
      border-radius: 8px;
      margin-bottom: 2rem;
      font-size: 0.85rem;
      color: #aaa;
      line-height: 1.6;
    }

    /* Responsive */
    @media (max-width: 1024px) {
      .sidebar {
        width: 220px;
      }

      .main-content {
        padding: 2rem 1.5rem;
      }
    }

    @media (max-width: 768px) {
      .container {
        flex-direction: column;
      }

      .sidebar {
        width: 100%;
        height: auto;
        border-right: none;
        border-bottom: 2px solid rgba(255, 107, 53, 0.2);
        padding: 1rem;
      }

      .main-content {
        margin-top: 0;
        height: auto;
      }

      .header-bar {
        flex-wrap: wrap;
        height: auto;
        padding: 1rem;
      }

      .header-actions {
        width: 100%;
        margin-top: 1rem;
      }

      .form-row {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <!-- Header Bar -->
  <div class="header-bar">
    <div class="header-left">
      <button class="back-btn" onclick="goBack()">‚Üê Back</button>
      <div class="header-title">
        <h1>Pentest Report</h1>
        <span>Offensive Security Assessment</span>
      </div>
    </div>
    <div class="header-actions">
      <button class="generate-btn">Generate Report ‚Üí</button>
    </div>
  </div>

  <div class="container">
    <!-- Sidebar Navigation -->
    <aside class="sidebar">
      <div class="progress-container">
        <div class="progress-label">Progress</div>
        <div class="progress-bar-container">
          <div class="progress-bar" id="progressBar"></div>
        </div>
        <div class="progress-text"><span id="progressText">3/10</span> sections completed</div>
      </div>

      <nav class="nav-section">
        <div class="nav-item active" data-section="cover" onclick="navigateToSection('cover')">Cover Page</div>
        <div class="nav-item" data-section="executive" onclick="navigateToSection('executive')">Executive Summary</div>
        <div class="nav-item" data-section="methodology" onclick="navigateToSection('methodology')">Methodology</div>
        <div class="nav-item" data-section="scope" onclick="navigateToSection('scope')">Scope & Perimeter</div>
        <div class="nav-item" data-section="results" onclick="navigateToSection('results')">Results Summary</div>
        <div class="nav-item" data-section="vulnerabilities" onclick="navigateToSection('vulnerabilities')">Vulnerabilities</div>
        <div class="nav-item" data-section="matrix" onclick="navigateToSection('matrix')">Risk Matrix</div>
        <div class="nav-item" data-section="scenarios" onclick="navigateToSection('scenarios')">Attack Scenarios</div>
        <div class="nav-item" data-section="recommendations" onclick="navigateToSection('recommendations')">Recommendations</div>
        <div class="nav-item" data-section="annexes" onclick="navigateToSection('annexes')">Annexes</div>
      </nav>
    </aside>

    <!-- Main Content -->
    <main class="main-content">

      <!-- Section 1: Cover Page -->
      <section class="form-section" id="cover">
        <div class="section-header">
          <h2 class="section-title">üìÑ Cover Page</h2>
          <p class="section-subtitle">Basic information about the assessment</p>
        </div>

        <div class="form-group">
          <label class="form-label">Client Name</label>
          <input data-section="cover" data-field="client-name" type="text" class="form-input" placeholder="e.g., Acme Corporation">
        </div>

        <div class="form-row">
          <div class="form-group">
            <label class="form-label">Assessment Date</label>
            <input data-section="cover" data-field="assessment-date" type="date" class="form-input">
          </div>
          <div class="form-group">
            <label class="form-label">Testing Period</label>
            <input data-section="cover" data-field="testing-period" type="text" class="form-input" placeholder="e.g., 2025-01-15 to 2025-01-20">
          </div>
        </div>

        <div class="form-group">
          <label class="form-label">Classification Level</label>
          <select data-section="cover" data-field="classification-level" class="form-select">
            <option value="">Select classification...</option>
            <option value="public">Public</option>
            <option value="internal">Internal Use</option>
            <option value="confidential">Confidential</option>
            <option value="strictly">Strictly Confidential</option>
          </select>
        </div>

        <div class="form-navigation">
          <div></div>
          <button class="nav-btn next-btn" onclick="nextSection()">Next Section ‚Üí</button>
        </div>
      </section>

      <!-- Section 2: Executive Summary -->
      <section class="form-section" id="executive">
        <div class="section-header">
          <h2 class="section-title">üìä Executive Summary</h2>
          <p class="section-subtitle">High-level overview for decision makers (non-technical)</p>
        </div>

        <div class="info-box">
          This section should be understandable by C-level executives without technical background.
        </div>

        <div class="form-group">
          <label class="form-label">Main Objective</label>
          <textarea data-section="executive" data-field="main-objective" class="form-textarea" placeholder="What was the primary goal of this penetration test?"></textarea>
        </div>

        <div class="form-group">
          <label class="form-label">Global Scope</label>
          <textarea data-section="executive" data-field="global-scope" class="form-textarea" placeholder="Systems tested, type of test (black/grey/white box)"></textarea>
        </div>

        <div class="form-group">
          <label class="form-label">Top 3 Major Risks Identified</label>
          <textarea data-section="executive" data-field="major-risk" class="form-textarea" placeholder="List the 3 most critical findings in simple terms"></textarea>
        </div>

        <div class="form-group">
          <label class="form-label">Overall Impact Summary</label>
          <textarea data-section="executive" data-field="impact-summary" class="form-textarea" placeholder="One sentence summary of the global impact"></textarea>
        </div>

        <div class="form-group">
          <label class="form-label">Strategic Recommendations</label>
          <textarea data-section="executive" data-field="recommendations" class="form-textarea" placeholder="High-level recommendations for improving security posture"></textarea>
        </div>

        <div class="form-navigation">
          <button class="nav-btn prev-btn" onclick="prevSection()">‚Üê Previous</button>
          <button class="nav-btn next-btn" onclick="nextSection()">Next Section ‚Üí</button>
        </div>
      </section>

      <!-- Section 3: Methodology -->
      <section class="form-section active" id="methodology">
        <div class="section-header">
          <h2 class="section-title">üî¨ Methodology</h2>
          <p class="section-subtitle">Framework and approach used during the assessment</p>
        </div>

        <div class="form-group">
          <label class="form-label">Standard/Framework Used</label>
          <select data-section="methodology" data-field="framework-used" class="form-select">
            <option value="">Select framework...</option>
            <option value="ptes">PTES (Penetration Testing Execution Standard)</option>
            <option value="owasp">OWASP Testing Guide</option>
            <option value="nist">NIST SP 800-115</option>
            <option value="osstmm">OSSTMM</option>
            <option value="custom">Custom Methodology</option>
          </select>
        </div>

        <div class="form-group">
          <label class="form-label">Testing Phases</label>
          <textarea data-section="methodology" data-field="steps-followed" class="form-textarea" placeholder="Describe the steps followed (reconnaissance, scanning, exploitation, post-exploitation, reporting)"></textarea>
        </div>

        <div class="form-group">
          <label class="form-label">Limitations & Exclusions</label>
          <textarea data-section="methodology" data-field="limitations" class="form-textarea" placeholder="What was explicitly excluded or limited during the test?"></textarea>
        </div>

        <div class="form-navigation">
          <button class="nav-btn prev-btn" onclick="prevSection()">‚Üê Previous</button>
          <button class="nav-btn next-btn" onclick="nextSection()">Next Section ‚Üí</button>
        </div>
      </section>

      <!-- Section 4: Scope & Perimeter -->
      <section class="form-section" id="scope">
        <div class="section-header">
          <h2 class="section-title">üéØ Scope & Perimeter</h2>
          <p class="section-subtitle">Assets and boundaries of the assessment</p>
        </div>

        <div class="form-group">
          <label class="form-label">Assets Tested</label>
          <textarea data-section="scope" data-field="assets-tested" class="form-textarea" placeholder="IP addresses, domains, applications, services (e.g., 192.168.1.0/24, app.example.com)"></textarea>
        </div>

        <div class="form-group">
          <label class="form-label">Restrictions Defined</label>
          <textarea data-section="scope" data-field="restrictions-definied" class="form-textarea" placeholder="Any restrictions agreed upon with the client (systems to avoid, specific hours, etc.)"></textarea>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label class="form-label">Test Duration</label>
            <input data-section="scope" data-field="test-duration" type="text" class="form-input" placeholder="e.g., 5 days">
          </div>
          <div class="form-group">
            <label class="form-label">Test Context</label>
            <select data-section="scope" data-field="test-context" class="form-select">
              <option value="">Select context...</option>
              <option value="blackbox">Black Box</option>
              <option value="greybox">Grey Box</option>
              <option value="whitebox">White Box</option>
            </select>
          </div>
        </div>

        <div class="form-navigation">
          <button class="nav-btn prev-btn" onclick="prevSection()">‚Üê Previous</button>
          <button class="nav-btn next-btn" onclick="nextSection()">Next Section ‚Üí</button>
        </div>
      </section>

      <!-- Section 5: Results Summary -->
      <section class="form-section" id="results">
        <div class="section-header">
          <h2 class="section-title">üìà Results Summary</h2>
          <p class="section-subtitle">Quick overview of findings by severity</p>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label class="form-label">Critical Vulnerabilities</label>
            <input data-section="results" data-field="critical-vulns" type="number" class="form-input" placeholder="0" min="0">
          </div>
          <div class="form-group">
            <label class="form-label">High Vulnerabilities</label>
            <input data-section="results" data-field="high-vulns" type="number" class="form-input" placeholder="0" min="0">
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label class="form-label">Medium Vulnerabilities</label>
            <input data-section="results" data-field="medium-vulns" type="number" class="form-input" placeholder="0" min="0">
          </div>
          <div class="form-group">
            <label class="form-label">Low Vulnerabilities</label>
            <input data-section="results" data-field="low-vulns" type="number" class="form-input" placeholder="0" min="0">
          </div>
        </div>

        <div class="form-group">
          <label class="form-label">Global Security Score <span class="form-label-optional">(optional)</span></label>
          <input data-section="results" data-field="global-score" type="text" class="form-input" placeholder="e.g., 6.5/10 or 65% compliant">
        </div>

        <div class="form-navigation">
          <button class="nav-btn prev-btn" onclick="prevSection()">‚Üê Previous</button>
          <button class="nav-btn next-btn" onclick="nextSection()">Next Section ‚Üí</button>
        </div>
      </section>

      <!-- Section 6: Vulnerabilities -->
      <section class="form-section" id="vulnerabilities">
        <div class="section-header">
          <h2 class="section-title">üîê Detailed Vulnerabilities</h2>
          <p class="section-subtitle">Comprehensive analysis of each finding</p>
        </div>

        <div class="info-box">
          Add as many vulnerabilities as needed. Each will be detailed with description, impact, proof, and recommendations.
        </div>

        <div id="vulnerabilitiesList">
          <!-- Vulnerability 1 -->
          <div class="vuln-entry">
            <div class="vuln-header">
              <span class="vuln-number">Vulnerability #1</span>
              <button class="remove-vuln-btn" onclick="removeVuln(this)">Remove</button>
            </div>

            <div class="form-group">
              <label class="form-label">Title / Unique ID</label>
              <input data-section="vulnerabilities" data-field="title" type="text" class="form-input" placeholder="e.g., SQL Injection in Login Form">
            </div>

            <div class="form-group">
              <label class="form-label">Severity</label>
              <select data-section="vulnerabilities" data-field="severity" class="form-select">
                <option value="">Select severity...</option>
                <option value="critical">Critical</option>
                <option value="high">High</option>
                <option value="medium">Medium</option>
                <option value="low">Low</option>
                <option value="info">Informational</option>
              </select>
            </div>

            <div class="form-group">
              <label class="form-label">Description</label>
              <textarea data-section="vulnerabilities" data-field="description" class="form-textarea" placeholder="What is this vulnerability and why does it matter?"></textarea>
            </div>

            <div class="form-group">
              <label class="form-label">Proof / Evidence</label>
              <textarea data-section="vulnerabilities" data-field="proof" class="form-textarea" placeholder="Screenshots, logs, or command outputs demonstrating the vulnerability"></textarea>
            </div>

            <div class="form-group">
              <label class="form-label">Impact (CIA Triad)</label>
              <textarea data-section="vulnerabilities" data-field="impact" class="form-textarea" placeholder="Impact on Confidentiality, Integrity, and Availability"></textarea>
            </div>

            <div class="form-group">
              <label class="form-label">Exploitation Vector</label>
              <textarea data-section="vulnerabilities" data-field="exploit-vector" class="form-textarea" placeholder="How can this vulnerability be exploited?"></textarea>
            </div>

            <div class="form-group">
              <label class="form-label">Recommendation</label>
              <textarea data-section="vulnerabilities" data-field="recommendations" class="form-textarea" placeholder="Technical and organizational remediation steps"></textarea>
            </div>

            <div class="form-group">
              <label class="form-label">References <span class="form-label-optional">(optional)</span></label>
              <input data-section="vulnerabilities" data-field="references" type="text" class="form-input" placeholder="e.g., CVE-2023-1234, CWE-89, OWASP A3">
            </div>
          </div>
        </div>

        <button class="add-vuln-btn" onclick="addVulnerability()">
          <span>+ Add Another Vulnerability</span>
        </button>

        <div class="form-navigation">
          <button class="nav-btn prev-btn" onclick="prevSection()">‚Üê Previous</button>
          <button class="nav-btn next-btn" onclick="nextSection()">Next Section ‚Üí</button>
        </div>
      </section>

      <!-- Section 7: Risk Matrix -->
      <section class="form-section" id="matrix">
        <div class="section-header">
          <h2 class="section-title">üìä Risk Matrix</h2>
          <p class="section-subtitle">Visual representation of risk vs impact</p>
        </div>

        <div class="info-box">
          This section will generate a visual matrix based on your vulnerabilities. Provide details for positioning.
        </div>

        <div class="form-group">
          <label class="form-label">Matrix Configuration</label>
          <textarea data-section="matrix" data-field="matrix-config" class="form-textarea" placeholder="Describe how vulnerabilities should be positioned (e.g., SQL Injection: High probability, High impact)"></textarea>
        </div>

        <div class="form-group">
          <label class="form-label">Critical Vulnerabilities Positioning</label>
          <textarea data-section="matrix" data-field="critical-vulns" class="form-textarea" placeholder="List which vulnerabilities fall into the critical risk zone"></textarea>
        </div>

        <div class="form-navigation">
          <button class="nav-btn prev-btn" onclick="prevSection()">‚Üê Previous</button>
          <button class="nav-btn next-btn" onclick="nextSection()">Next Section ‚Üí</button>
        </div>
      </section>

      <!-- Section 8: Attack Scenarios -->
      <section class="form-section" id="scenarios">
        <div class="section-header">
          <h2 class="section-title">‚öîÔ∏è Attack Scenarios</h2>
          <p class="section-subtitle">Real-world exploitation chains</p>
        </div>

        <div class="info-box">
          Describe realistic attack paths combining multiple vulnerabilities to show actual risk.
        </div>

        <div class="form-group">
          <label class="form-label">Scenario 1: Attack Chain</label>
          <textarea data-section="scenarios" data-field="scenario-one" class="form-textarea" placeholder="Describe a complete attack path from initial access to impact (e.g., phishing ‚Üí credential theft ‚Üí lateral movement ‚Üí data exfiltration)"></textarea>
        </div>

        <div class="form-group">
          <label class="form-label">Scenario 2: Alternative Path <span class="form-label-optional">(optional)</span></label>
          <textarea data-section="scenarios" data-field="scenario-two" class="form-textarea" placeholder="Another realistic attack scenario"></textarea>
        </div>

        <div class="form-group">
          <label class="form-label">Real-World Impact Illustration</label>
          <textarea data-section="scenarios" data-field="real-world-impact" class="form-textarea" placeholder="What would be the business impact if these scenarios were executed by a real attacker?"></textarea>
        </div>

        <div class="form-navigation">
          <button class="nav-btn prev-btn" onclick="prevSection()">‚Üê Previous</button>
          <button class="nav-btn next-btn" onclick="nextSection()">Next Section ‚Üí</button>
        </div>
      </section>

      <!-- Section 9: Recommendations -->
      <section class="form-section" id="recommendations">
        <div class="section-header">
          <h2 class="section-title">üí° Global Recommendations</h2>
          <p class="section-subtitle">Strategic and tactical improvements</p>
        </div>

        <div class="form-group">
          <label class="form-label">Immediate Actions (Quick Wins)</label>
          <textarea data-section="recommendations" data-field="immediate-actions" class="form-textarea" placeholder="What can be fixed right away? (e.g., patch critical systems, disable exposed services)"></textarea>
        </div>

        <div class="form-group">
          <label class="form-label">Medium-Term Improvements</label>
          <textarea data-section="recommendations" data-field="medium-term-actions" class="form-textarea" placeholder="Actions for the next 3-6 months (e.g., implement WAF, security training, patch management process)"></textarea>
        </div>

        <div class="form-group">
          <label class="form-label">Long-Term Strategic Changes</label>
          <textarea data-section="recommendations" data-field="long-term-actions" class="form-textarea" placeholder="Structural improvements (e.g., security culture, monitoring solutions, incident response plan)"></textarea>
        </div>

        <div class="form-group">
          <label class="form-label">Overall Security Posture Improvements</label>
          <textarea data-section="recommendations" data-field="overall-security" class="form-textarea" placeholder="General recommendations for improving the organization's security maturity"></textarea>
        </div>

        <div class="form-navigation">
          <button class="nav-btn prev-btn" onclick="prevSection()">‚Üê Previous</button>
          <button class="nav-btn next-btn" onclick="nextSection()">Next Section ‚Üí</button>
        </div>
      </section>

      <!-- Section 10: Annexes -->
      <section class="form-section" id="annexes">
        <div class="section-header">
          <h2 class="section-title">üìé Annexes</h2>
          <p class="section-subtitle">Supporting documentation and references</p>
        </div>

        <div class="form-group">
          <label class="form-label">Glossary <span class="form-label-optional">(optional)</span></label>
          <textarea data-section="annexes" data-field="glossary" class="form-textarea" placeholder="Define technical terms for non-technical readers"></textarea>
        </div>

        <div class="form-group">
          <label class="form-label">Tools Used</label>
          <textarea data-section="annexes" data-field="tools-used" class="form-textarea" placeholder="List of tools and versions (e.g., Nmap 7.94, Burp Suite Pro 2024.1, Metasploit 6.3)"></textarea>
        </div>

        <div class="form-group">
          <label class="form-label">Scripts & Commands <span class="form-label-optional">(optional)</span></label>
          <textarea data-section="annexes" data-field="scripts-commands" class="form-textarea" placeholder="Custom scripts or specific commands used during testing"></textarea>
        </div>

        <div class="form-group">
          <label class="form-label">Raw Tool Outputs <span class="form-label-optional">(optional)</span></label>
          <textarea data-section="annexes" data-field="raw-tool" class="form-textarea" placeholder="Raw results from automated scanners (can be referenced or attached separately)"></textarea>
        </div>

        <div class="form-group">
          <label class="form-label">External References</label>
          <textarea data-section="annexes" data-field="external-ref" class="form-textarea" placeholder="Links to CVE databases, OWASP guides, vendor advisories, etc."></textarea>
        </div>

        <div class="form-navigation">
          <button class="nav-btn prev-btn" onclick="prevSection()">‚Üê Previous</button>
          <div></div>
        </div>
      </section>
    </main>
  </div>

  <script>    
    const sections = ['cover', 'executive', 'methodology', 'scope', 'results', 'vulnerabilities', 'matrix', 'scenarios', 'recommendations', 'annexes'];
    let currentSectionIndex = 0;
    let vulnCounter = 1;

    // Navigation between sections
    function navigateToSection(sectionId) {
      // Hide all sections
      document.querySelectorAll('.form-section').forEach(section => {
        section.classList.remove('active');
      });

      // Remove active from all nav items
      document.querySelectorAll('.nav-item').forEach(item => {
        item.classList.remove('active');
      });

      // Show selected section
      document.getElementById(sectionId).classList.add('active');
      
      // Mark nav item as active
      const navItem = document.querySelector(`[data-section="${sectionId}"]`);
      if (navItem) {
        navItem.classList.add('active');
      }

      // Update current index
      currentSectionIndex = sections.indexOf(sectionId);
      
      // Update progress
      updateProgress();
    }

    function nextSection() {
      if (currentSectionIndex < sections.length - 1) {
        const currentNavItem = document.querySelector(`[data-section="${sections[currentSectionIndex]}"]`);
        if (currentNavItem && !currentNavItem.classList.contains('completed')) {
          currentNavItem.classList.add('completed');
        }
        
        currentSectionIndex++;
        navigateToSection(sections[currentSectionIndex]);
      }
    }

    function prevSection() {
      if (currentSectionIndex > 0) {
        const currentNavItem = document.querySelector(`[data-section="${sections[currentSectionIndex]}"]`);
        if (currentNavItem && currentNavItem.classList.contains('completed')) {
          currentNavItem.classList.remove('completed');
          currentNavItem.classList.remove('active');
        }
        
        currentSectionIndex--;
        navigateToSection(sections[currentSectionIndex]);
      }
    }

    // Update progress bar
    function updateProgress() {
      const completedCount = document.querySelectorAll('.nav-item.completed').length;
      const totalSections = sections.length;
      const percentage = (completedCount / totalSections) * 100;
      
      document.getElementById('progressBar').style.width = percentage + '%';
      document.getElementById('progressText').textContent = completedCount + '/' + totalSections;
    }

    // Vulnerability management
    function addVulnerability() {
      vulnCounter++;
      const vulnList = document.getElementById('vulnerabilitiesList');
      
      const vulnHTML = `
        <div class="vuln-entry">
          <div class="vuln-header">
            <span class="vuln-number">Vulnerability #${vulnCounter}</span>
            <button class="remove-vuln-btn" onclick="removeVuln(this)">Remove</button>
          </div>

          <div class="form-group">
            <label class="form-label">Title / Unique ID</label>
            <input data-section="vulnerabilities" data-field="title" type="text" class="form-input" placeholder="e.g., SQL Injection in Login Form">
          </div>

          <div class="form-group">
            <label class="form-label">Severity</label>
            <select data-section="vulnerabilities" data-field="severity" class="form-select">
              <option value="">Select severity...</option>
              <option value="critical">Critical</option>
              <option value="high">High</option>
              <option value="medium">Medium</option>
              <option value="low">Low</option>
              <option value="info">Informational</option>
            </select>
          </div>

          <div class="form-group">
            <label class="form-label">Description</label>
            <textarea data-section="vulnerabilities" data-field="description" class="form-textarea" placeholder="What is this vulnerability and why does it matter?"></textarea>
          </div>

          <div class="form-group">
            <label class="form-label">Proof / Evidence</label>
            <textarea data-section="vulnerabilities" data-field="proof" class="form-textarea" placeholder="Screenshots, logs, or command outputs demonstrating the vulnerability"></textarea>
          </div>

          <div class="form-group">
            <label class="form-label">Impact (CIA Triad)</label>
            <textarea data-section="vulnerabilities" data-field="impact" class="form-textarea" placeholder="Impact on Confidentiality, Integrity, and Availability"></textarea>
          </div>

          <div class="form-group">
            <label class="form-label">Exploitation Vector</label>
            <textarea data-section="vulnerabilities" data-field="exploit-vector" class="form-textarea" placeholder="How can this vulnerability be exploited?"></textarea>
          </div>

          <div class="form-group">
            <label class="form-label">Recommendation</label>
            <textarea data-section="vulnerabilities" data-field="recommendations" class="form-textarea" placeholder="Technical and organizational remediation steps"></textarea>
          </div>

          <div class="form-group">
            <label class="form-label">References <span class="form-label-optional">(optional)</span></label>
            <input data-section="vulnerabilities" data-field="references" type="text" class="form-input" placeholder="e.g., CVE-2023-1234, CWE-89, OWASP A3">
          </div>
        </div>
      `;
      
      vulnList.insertAdjacentHTML('beforeend', vulnHTML);
    }

    function removeVuln(btn) {
      const vulnEntry = btn.closest('.vuln-entry');
      vulnEntry.remove();
      
      // Renumber remaining vulnerabilities
      const vulnEntries = document.querySelectorAll('.vuln-entry');
      vulnEntries.forEach((entry, index) => {
        entry.querySelector('.vuln-number').textContent = `Vulnerability #${index + 1}`;
      });
      
      vulnCounter = vulnEntries.length;
    }

    // Header actions
    function goBack() {
      const url = '/reports-generator';

      if (window.parent) {
        const iframe = window.parent.document.getElementById('iframe-reports-generator');
        if (iframe) {
          iframe.src = url;
        } else {
          console.error("Iframe parent introuvable !");
        }
      } else {
        window.location.href = url;
      }
    }

    function previewReport() {
      alert('Preview functionality coming soon...');
    }

    async function generateReport() {
      const formData = collectFormData();
      console.log(formData);
      
      // Afficher un loader
      const generateBtn = document.querySelector('.generate-btn');
      const originalText = generateBtn.textContent;
      generateBtn.textContent = '‚è≥ Generating...';
      generateBtn.disabled = true;
      
      // Type de rapport
      const reportType = "pentest";
      
      try {
        const response = await fetch('/api/generate_report', {
          method: 'POST',
          mode: 'cors',
          credentials: 'same-origin',
          headers: {
            'Content-Type': 'application/json',
            "X-Report-Type": reportType,
          },
          body: JSON.stringify(formData)
        });
        
        if (response.ok) {
          // R√©cup√©rer le PDF en tant que Blob
          const pdfBlob = await response.blob();
          
          // Cr√©er une URL temporaire
          const pdfUrl = window.URL.createObjectURL(pdfBlob);
          
          // G√©n√©rer le nom de fichier dynamique
          const timestamp = new Date().toISOString().split('T')[0]; // Format: 2024-10-30
          const reportTypeNames = {
            'threat-int': 'threat-intelligence-report',
            'osint': 'osint-report',
            'pentest': 'penetration-test-report'
          };
          const fileName = `${reportTypeNames[reportType] || 'report'}-${timestamp}.pdf`;
          
          // T√©l√©charger le fichier
          const a = document.createElement('a');
          a.href = pdfUrl;
          a.download = fileName;
          document.body.appendChild(a);
          a.click();
          
          // Nettoyage
          document.body.removeChild(a);
          window.URL.revokeObjectURL(pdfUrl);
          
          alert('‚úÖ Report generated and downloaded successfully!');
          
        } else {
          const errorText = await response.text();
          alert('‚ùå Error generating report: ' + errorText);
          console.error('Server error:', response.status, errorText);
        }
      } catch (error) {
        console.error('Error:', error);
        alert('‚ùå Network error. Please check your connection and try again.');
      } finally {
        // Restaurer le bouton
        generateBtn.textContent = originalText;
        generateBtn.disabled = false;
      }
    }

    const generateBtn = Array.from(document.getElementsByClassName("generate-btn"))[0];
    generateBtn.addEventListener('click', async (event) => {
      event.preventDefault();
      await generateReport();
    });

    // Auto-save functionality (future implementation)
    let autoSaveTimer;
    document.querySelectorAll('.form-input, .form-textarea, .form-select').forEach(element => {
      element.addEventListener('input', () => {
        clearTimeout(autoSaveTimer);
        autoSaveTimer = setTimeout(() => {
          console.log('Auto-saving draft...');
          // Implement auto-save to localStorage or backend when user system is ready
        }, 2000);
      });
    });


//===========================================================+
//      Collect Data & Send to Backend 
//===========================================================+

function collectFormData() {
  const formData = {
    cover: {},
    executive: {},
    methodology: {},
    scope: {},
    results: {},
    vulnerabilities: [],
    matrix: {},
    scenarios: {},
    recommendations: {},
    annexes: {}
  };

  // 1. Collecter les champs simples (input, textarea, select)
  document.querySelectorAll('[data-field]').forEach(element => {
    const section = element.getAttribute('data-section');
    const field = element.getAttribute('data-field');
    let value = element.value.trim();
    
    if (section && field && value !== '') {
      // Si c'est une section autre que vulnerabilities, ajouter directement
      if (section !== 'vulnerabilities') {
        formData[section][field] = value;
      }
    }
  });

  // 2. Collecter les vuln√©rabilit√©s
  const vulnEntries = document.querySelectorAll('#vulnerabilitiesList .vuln-entry');
  vulnEntries.forEach((entry, index) => {
    const vuln = {
      id: index + 1,
      title: '',
      severity: '',
      description: '',
      proof: '',
      impact: '',
      exploitation_vector: '',
      recommendation: '',
      references: ''
    };

    const inputs = entry.querySelectorAll('.form-input');
    const selects = entry.querySelectorAll('.form-select');
    const textareas = entry.querySelectorAll('.form-textarea');

    // Title
    if (inputs[0]?.value.trim()) {
      vuln.title = inputs[0].value.trim();
    }

    // Severity
    if (selects[0]?.value) {
      vuln.severity = selects[0].value;
    }

    // Description
    if (textareas[0]?.value.trim()) {
      vuln.description = textareas[0].value.trim();
    }

    // Proof
    if (textareas[1]?.value.trim()) {
      vuln.proof = textareas[1].value.trim();
    }

    // Impact
    if (textareas[2]?.value.trim()) {
      vuln.impact = textareas[2].value.trim();
    }

    // Exploitation Vector
    if (textareas[3]?.value.trim()) {
      vuln.exploitation_vector = textareas[3].value.trim();
    }

    // Recommendation
    if (textareas[4]?.value.trim()) {
      vuln.recommendation = textareas[4].value.trim();
    }

    // References
    if (inputs[1]?.value.trim()) {
      vuln.references = inputs[1].value.trim();
    }

    // Ajouter seulement si au moins le titre ou la s√©v√©rit√© est rempli
    if (vuln.title || vuln.severity) {
      formData.vulnerabilities.push(vuln);
    }
  });

  return formData;
}


//===========================================================+
//      INIT
//===========================================================+

    updateProgress();
  </script>
</body>
</html>